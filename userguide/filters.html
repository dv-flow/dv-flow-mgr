<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Filters &#8212; DV Flow Manager  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advanced Features" href="advanced_features.html" />
    <link rel="prev" title="Expressions" href="expressions.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="filters">
<h1>Filters<a class="headerlink" href="#filters" title="Link to this heading">¶</a></h1>
<p>Filters provide a powerful way to transform and select data in expressions.
Inspired by Unix pipes and JQ, filters let you chain operations to process
inputs, parameter values, and other data.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>A filter is a reusable transformation that can be applied to data using the
pipe operator <code class="docutils literal notranslate"><span class="pre">|</span></code>. Filters can:</p>
<ul class="simple">
<li><p>Select items based on criteria (e.g., by file type)</p></li>
<li><p>Transform data structures (e.g., extract field values)</p></li>
<li><p>Aggregate information (e.g., count by type)</p></li>
</ul>
<p>Example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compile</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">find_sources</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">consumes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">std.FileSet</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">sv_files</span><span class="p">:</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">by_filetype(&#39;.sv&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
<p>The expression <code class="docutils literal notranslate"><span class="pre">inputs</span> <span class="pre">|</span> <span class="pre">by_filetype('.sv')</span></code> pipes the <code class="docutils literal notranslate"><span class="pre">inputs</span></code> array
through the <code class="docutils literal notranslate"><span class="pre">by_filetype</span></code> filter, which returns only items with <code class="docutils literal notranslate"><span class="pre">.sv</span></code>
extensions.</p>
</section>
<section id="using-filters">
<h2>Using Filters<a class="headerlink" href="#using-filters" title="Link to this heading">¶</a></h2>
<section id="basic-usage">
<h3>Basic Usage<a class="headerlink" href="#basic-usage" title="Link to this heading">¶</a></h3>
<p>Apply a filter using the pipe operator:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter by file extension</span>
<span class="nt">sv_files</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">by_filetype(&#39;.sv&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># Filter by type</span>
<span class="nt">filesets</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">by_type(&#39;std.FileSet&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># Get all paths</span>
<span class="nt">all_paths</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">paths</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</section>
<section id="filters-with-parameters">
<h3>Filters with Parameters<a class="headerlink" href="#filters-with-parameters" title="Link to this heading">¶</a></h3>
<p>Some filters accept parameters:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter by specific extension</span>
<span class="nt">verilog</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">by_filetype(&#39;.v&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># Get first item of type</span>
<span class="nt">first_fs</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">first_of_type(&#39;std.FileSet&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># Extract specific field</span>
<span class="nt">types</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">pluck(&#39;type&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</section>
<section id="chaining-filters">
<h3>Chaining Filters<a class="headerlink" href="#chaining-filters" title="Link to this heading">¶</a></h3>
<p>Chain multiple filters for complex transformations:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get unique sorted extensions</span>
<span class="nt">extensions</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">paths</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">extensions</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">unique</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">sort</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># Get basenames of SystemVerilog files</span>
<span class="nt">sv_names</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">by_filetype(&#39;.sv&#39;)</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">basenames</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># Count then reverse</span>
<span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">values</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">sort</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">reverse</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</section>
<section id="combining-with-builtins">
<h3>Combining with Builtins<a class="headerlink" href="#combining-with-builtins" title="Link to this heading">¶</a></h3>
<p>Filters work seamlessly with JQ-style builtins:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Count filtered items</span>
<span class="nt">sv_count</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">by_filetype(&#39;.sv&#39;)</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">length</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># Get last path</span>
<span class="nt">last_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">paths</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">last</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># Split and filter</span>
<span class="nt">basename</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">path</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">split(&#39;/&#39;)</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">last</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="defining-filters">
<h2>Defining Filters<a class="headerlink" href="#defining-filters" title="Link to this heading">¶</a></h2>
<p>Filters are defined at the package level using the <code class="docutils literal notranslate"><span class="pre">filters</span></code> key.</p>
<section id="basic-filter">
<h3>Basic Filter<a class="headerlink" href="#basic-filter" title="Link to this heading">¶</a></h3>
<p>A simple filter without parameters:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">package</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myproject</span>

<span class="w">  </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">text_files</span>
<span class="w">      </span><span class="nt">export</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">input[] | select(input.path | split(&quot;.&quot;) | last | . == &quot;txt&quot;)</span>
</pre></div>
</div>
<p>This filter iterates through <code class="docutils literal notranslate"><span class="pre">input</span></code> and selects items with <code class="docutils literal notranslate"><span class="pre">.txt</span></code> extensions.</p>
</section>
<section id="parameterized-filter">
<h3>Parameterized Filter<a class="headerlink" href="#parameterized-filter" title="Link to this heading">¶</a></h3>
<p>Filters can accept parameters using <code class="docutils literal notranslate"><span class="pre">with</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filters</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">by_pattern</span>
<span class="w">    </span><span class="nt">export</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">pattern</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">input[] | select(input.path | test($arg0))</span>
</pre></div>
</div>
<p>Parameters are accessed as <code class="docutils literal notranslate"><span class="pre">$arg0</span></code>, <code class="docutils literal notranslate"><span class="pre">$arg1</span></code>, etc. (positional).</p>
<p>Usage:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">matches</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">by_pattern(&#39;.*_test\\.sv&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</section>
<section id="executable-filters">
<h3>Executable Filters<a class="headerlink" href="#executable-filters" title="Link to this heading">¶</a></h3>
<p>Filters can execute Python or Shell scripts:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filters</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">process_data</span>
<span class="w">    </span><span class="nt">export</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">import json</span>
<span class="w">      </span><span class="no">import sys</span>
<span class="w">      </span><span class="no">data = json.load(sys.stdin)</span>
<span class="w">      </span><span class="no">result = [item for item in data if item[&#39;size&#39;] &gt; 1000]</span>
<span class="w">      </span><span class="no">print(json.dumps(result))</span>
<span class="w">    </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
</pre></div>
</div>
<p>The script receives data via stdin and outputs JSON via stdout.</p>
</section>
</section>
<section id="filter-visibility">
<h2>Filter Visibility<a class="headerlink" href="#filter-visibility" title="Link to this heading">¶</a></h2>
<p>Filters support visibility modifiers:</p>
<section id="export">
<h3>Export<a class="headerlink" href="#export" title="Link to this heading">¶</a></h3>
<p>Make a filter available to importing packages:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filters</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">public_filter</span>
<span class="w">    </span><span class="nt">export</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;input[]&quot;</span>
</pre></div>
</div>
</section>
<section id="local">
<h3>Local<a class="headerlink" href="#local" title="Link to this heading">¶</a></h3>
<p>Hide a filter from child packages:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filters</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">internal_filter</span>
<span class="w">    </span><span class="nt">local</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;input[]&quot;</span>
</pre></div>
</div>
</section>
<section id="default-visibility">
<h3>Default Visibility<a class="headerlink" href="#default-visibility" title="Link to this heading">¶</a></h3>
<p>By default, filters have <code class="docutils literal notranslate"><span class="pre">name</span></code> visibility (visible to package and children,
but not to importers).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filters</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">package_filter</span>
<span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;input[]&quot;</span>
</pre></div>
</div>
</section>
<section id="qualified-names">
<h3>Qualified Names<a class="headerlink" href="#qualified-names" title="Link to this heading">¶</a></h3>
<p>Reference filters from other packages:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">result</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">mypackage.custom_filter</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="standard-library-filters">
<h2>Standard Library Filters<a class="headerlink" href="#standard-library-filters" title="Link to this heading">¶</a></h2>
<p>See <a class="reference internal" href="stdlib.html"><span class="doc">Standard Library</span></a> for documentation of all standard library filters, including:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">by_filetype(ext)</span></code> - Filter by file extension</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">by_type(typename)</span></code> - Filter by data type</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">basenames</span></code> - Extract filenames</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extensions</span></code> - Extract file extensions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">paths</span></code> - Get all paths from FileSets</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">first_of_type(typename)</span></code> - Get first item of type</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pluck(field)</span></code> - Extract field values</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">count_by_type</span></code> - Count by type</p></li>
</ul>
</section>
<section id="advanced-topics">
<h2>Advanced Topics<a class="headerlink" href="#advanced-topics" title="Link to this heading">¶</a></h2>
<section id="runtime-vs-static-evaluation">
<h3>Runtime vs Static Evaluation<a class="headerlink" href="#runtime-vs-static-evaluation" title="Link to this heading">¶</a></h3>
<p>Filters can be evaluated at different times:</p>
<p><strong>Static evaluation</strong> (during graph construction):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># params is known at graph construction</span>
<span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">params</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">length</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
<p><strong>Runtime evaluation</strong> (during task execution):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># inputs only known at runtime</span>
<span class="nt">file_count</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">length</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
<p>Expressions referencing <code class="docutils literal notranslate"><span class="pre">inputs</span></code> or <code class="docutils literal notranslate"><span class="pre">memento</span></code> are automatically deferred
and evaluated at runtime.</p>
</section>
<section id="error-handling">
<h3>Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading">¶</a></h3>
<p>Filters should handle missing or invalid data gracefully:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Safe: returns empty array if no matches</span>
<span class="nt">result</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">by_filetype(&#39;.sv&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># Safe: returns null if type not found</span>
<span class="nt">first</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">first_of_type(&#39;MyType&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</section>
<section id="working-with-types">
<h3>Working with Types<a class="headerlink" href="#working-with-types" title="Link to this heading">¶</a></h3>
<p>Filters often work with data types. Access type information:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get type field</span>
<span class="nt">types</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">pluck(&#39;type&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># Filter by type</span>
<span class="nt">filesets</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">by_type(&#39;std.FileSet&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># Count by type</span>
<span class="nt">counts</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">count_by_type</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading">¶</a></h2>
<section id="keep-filters-simple">
<h3>Keep Filters Simple<a class="headerlink" href="#keep-filters-simple" title="Link to this heading">¶</a></h3>
<p>Prefer simple, single-purpose filters:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Good: focused filter</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sv_files</span>
<span class="w">  </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;input[]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">by_filetype(&#39;.sv&#39;)&quot;</span>

<span class="c1"># Better: reuse built-in</span>
<span class="nt">sv_files</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">by_filetype(&#39;.sv&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</section>
<section id="use-descriptive-names">
<h3>Use Descriptive Names<a class="headerlink" href="#use-descriptive-names" title="Link to this heading">¶</a></h3>
<p>Filter names should clearly indicate their purpose:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Good names</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">verilog_sources</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">by_author</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active_tasks</span>

<span class="c1"># Avoid</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">filter1</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">process</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">do_stuff</span>
</pre></div>
</div>
</section>
<section id="document-parameters">
<h3>Document Parameters<a class="headerlink" href="#document-parameters" title="Link to this heading">¶</a></h3>
<p>When filters take parameters, document them:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filters</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">files_larger_than</span>
<span class="w">    </span><span class="c1"># Parameters:</span>
<span class="w">    </span><span class="c1">#   size_kb: minimum file size in kilobytes</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">size_kb</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">input[] | select(input.size &gt; ($arg0 * 1024))</span>
</pre></div>
</div>
</section>
<section id="prefer-expression-filters">
<h3>Prefer Expression Filters<a class="headerlink" href="#prefer-expression-filters" title="Link to this heading">¶</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">expr</span></code> over <code class="docutils literal notranslate"><span class="pre">run</span></code> when possible:</p>
<ul class="simple">
<li><p>Expression filters are faster (no process spawn)</p></li>
<li><p>Expression filters are more declarative</p></li>
<li><p>Expression filters are easier to debug</p></li>
</ul>
<p>Only use <code class="docutils literal notranslate"><span class="pre">run</span></code> for complex logic requiring full scripting language.</p>
</section>
<section id="test-your-filters">
<h3>Test Your Filters<a class="headerlink" href="#test-your-filters" title="Link to this heading">¶</a></h3>
<p>Test filters with various inputs:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test with empty input</span>
<span class="nt">result</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">[]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">my_filter</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># Test with single item</span>
<span class="nt">result</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">[item]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">my_filter</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># Test with missing fields</span>
<span class="nt">result</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">items_without_path</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">my_filter</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="known-limitations">
<h2>Known Limitations<a class="headerlink" href="#known-limitations" title="Link to this heading">¶</a></h2>
<p>Current limitations of the filter system:</p>
<section id="map-and-select-arguments">
<h3>map() and select() Arguments<a class="headerlink" href="#map-and-select-arguments" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">map()</span></code> and <code class="docutils literal notranslate"><span class="pre">select()</span></code> builtins currently evaluate their arguments
before execution. This prevents per-item field access inside these operations:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># This does NOT work as expected:</span>
<span class="nt">filtered</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">map(select(input.type</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;FileSet&#39;))</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># Workaround: use simpler filters</span>
<span class="nt">filtered</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">inputs</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">by_type(&#39;FileSet&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
<p>This is a known limitation and may be addressed in future versions.</p>
</section>
<section id="implicit-input-context">
<h3>Implicit Input Context<a class="headerlink" href="#implicit-input-context" title="Link to this heading">¶</a></h3>
<p>Unlike native JQ, dv-flow uses explicit <code class="docutils literal notranslate"><span class="pre">input</span></code> variables rather than
implicit <code class="docutils literal notranslate"><span class="pre">.</span></code> context:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># JQ style (not supported):</span>
<span class="nt">result</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">.[]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">select(.type</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;A&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># dv-flow style (use explicit input):</span>
<span class="nt">result</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">input[]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</section>
<section id="negative-array-indices">
<h3>Negative Array Indices<a class="headerlink" href="#negative-array-indices" title="Link to this heading">¶</a></h3>
<p>Negative array indices are not currently supported:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Not supported:</span>
<span class="nt">last</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">array[-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># Use instead:</span>
<span class="nt">last</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">array</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">last</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="expressions.html"><span class="doc">Expressions</span></a> - Expression syntax and builtins</p></li>
<li><p><a class="reference internal" href="stdlib.html"><span class="doc">Standard Library</span></a> - Standard library filters and tasks</p></li>
<li><p><a class="reference internal" href="dataflow.html"><span class="doc">Dataflow &amp; Produces</span></a> - Data flow and task dependencies</p></li>
<li><p><a class="reference internal" href="tasks_using.html"><span class="doc">Using Tasks</span></a> - Using tasks in flows</p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">DV Flow Manager</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="fundamentals.html">Key Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="packages.html">Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks_using.html">Using Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataflow.html">Dataflow &amp; Produces</a></li>
<li class="toctree-l2"><a class="reference internal" href="visibility.html">Task Visibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks_developing.html">Developing Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="incremental.html">Incremental Builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Parameters and Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="expressions.html">Expressions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced_features.html">Advanced Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="stdlib.html">Standard Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="llm_integration.html">LLM Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="agent_integration.html">AI Agent Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#dataflow">Dataflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Flow-Spec Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/types_api.html">Type System API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cmdref.html">Command reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../llms.html">LLM Agent Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pytask_api.html">Python Task API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../task_runners.html">Task Runners</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">User Guide</a><ul>
      <li>Previous: <a href="expressions.html" title="previous chapter">Expressions</a></li>
      <li>Next: <a href="advanced_features.html" title="next chapter">Advanced Features</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2023-2025, Matthew Ballance.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/userguide/filters.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>