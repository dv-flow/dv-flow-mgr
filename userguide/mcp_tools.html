<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MCP Tool Support &#8212; DV Flow Manager  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Flow-Spec Reference" href="../reference/index.html" />
    <link rel="prev" title="AI Agent Integration" href="agent_integration.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="mcp-tool-support">
<h1>MCP Tool Support<a class="headerlink" href="#mcp-tool-support" title="Link to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>MCP (Model Context Protocol) enables AI agents to interact with external tools and
services in a standardized way. DV Flow provides two task types for configuring
MCP servers:</p>
<ol class="arabic simple">
<li><p><strong>AgentToolStdio</strong>: For MCP servers using stdio transport (command-line tools)</p></li>
<li><p><strong>AgentToolHttp</strong>: For MCP servers using HTTP/SSE transport (remote services)</p></li>
</ol>
<p>Both tasks produce <code class="docutils literal notranslate"><span class="pre">std.AgentTool</span></code> data items that can be consumed by <code class="docutils literal notranslate"><span class="pre">Agent</span></code>
tasks to enable additional capabilities during agent execution.</p>
<p>The AgentTool tasks configure how MCP servers should be started, but do not start
them directly. The actual server processes are started by the Agent task or agent
command when needed.</p>
</section>
<section id="agenttoolstdio-task">
<h2>AgentToolStdio Task<a class="headerlink" href="#agenttoolstdio-task" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">AgentToolStdio</span></code> task configures MCP servers that communicate via stdio
(standard input/output). These are typically installed as npm or Python packages
and run as subprocesses.</p>
<section id="parameters">
<h3>Parameters<a class="headerlink" href="#parameters" title="Link to this heading">¶</a></h3>
<dl class="simple">
<dt><strong>command</strong> (string, required)</dt><dd><p>The command to execute the MCP server</p>
</dd>
<dt><strong>args</strong> (list, optional)</dt><dd><p>Command-line arguments to pass to the server</p>
</dd>
<dt><strong>install_command</strong> (string, optional)</dt><dd><p>Command to run before first use (e.g., <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">install</span></code>)</p>
</dd>
<dt><strong>env</strong> (map, optional)</dt><dd><p>Environment variables to set when running the server</p>
</dd>
</dl>
</section>
<section id="basic-example">
<h3>Basic Example<a class="headerlink" href="#basic-example" title="Link to this heading">¶</a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FileSystemTool</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.AgentToolStdio</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npx</span>
<span class="w">      </span><span class="nt">args</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-y</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;@modelcontextprotocol/server-filesystem&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/allowed/directory</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MyAgent</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.Agent</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">FileSystemTool</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">user_prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;List</span><span class="nv"> </span><span class="s">all</span><span class="nv"> </span><span class="s">Python</span><span class="nv"> </span><span class="s">files</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">workspace&quot;</span>
</pre></div>
</div>
</section>
<section id="with-installation-command">
<h3>With Installation Command<a class="headerlink" href="#with-installation-command" title="Link to this heading">¶</a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FileSystemTool</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.AgentToolStdio</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npx</span>
<span class="w">      </span><span class="nt">args</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-y</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;@modelcontextprotocol/server-filesystem&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/workspace</span>
<span class="w">      </span><span class="nt">install_command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;npm</span><span class="nv"> </span><span class="s">install</span><span class="nv"> </span><span class="s">-g</span><span class="nv"> </span><span class="s">@modelcontextprotocol/server-filesystem&quot;</span>
<span class="w">      </span><span class="nt">env</span><span class="p">:</span>
<span class="w">        </span><span class="nt">NODE_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</pre></div>
</div>
</section>
<section id="with-environment-variables">
<h3>With Environment Variables<a class="headerlink" href="#with-environment-variables" title="Link to this heading">¶</a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GitTool</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.AgentToolStdio</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npx</span>
<span class="w">      </span><span class="nt">args</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-y</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;@modelcontextprotocol/server-git&quot;</span>
<span class="w">      </span><span class="nt">env</span><span class="p">:</span>
<span class="w">        </span><span class="nt">GIT_CONFIG_GLOBAL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/custom/gitconfig</span>
</pre></div>
</div>
</section>
<section id="common-mcp-servers-stdio">
<h3>Common MCP Servers (Stdio)<a class="headerlink" href="#common-mcp-servers-stdio" title="Link to this heading">¶</a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Server</p></th>
<th class="head"><p>Package</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>filesystem</p></td>
<td><p>&#64;modelcontextprotocol/server-filesystem</p></td>
<td><p>Read/write files in directories</p></td>
</tr>
<tr class="row-odd"><td><p>github</p></td>
<td><p>&#64;modelcontextprotocol/server-github</p></td>
<td><p>GitHub API integration</p></td>
</tr>
<tr class="row-even"><td><p>sqlite</p></td>
<td><p>mcp-server-sqlite</p></td>
<td><p>SQLite database queries</p></td>
</tr>
<tr class="row-odd"><td><p>git</p></td>
<td><p>&#64;modelcontextprotocol/server-git</p></td>
<td><p>Git repository operations</p></td>
</tr>
<tr class="row-even"><td><p>fetch</p></td>
<td><p>&#64;modelcontextprotocol/server-fetch</p></td>
<td><p>HTTP requests with caching</p></td>
</tr>
</tbody>
</table>
</section>
<section id="implementation-details">
<h3>Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">AgentToolStdio</span></code> task:</p>
<ol class="arabic simple">
<li><p>Optionally runs the <code class="docutils literal notranslate"><span class="pre">install_command</span></code> if specified and not previously executed</p></li>
<li><p>Validates that the command exists and is executable</p></li>
<li><p>Creates a memento with hash of command/args for up-to-date tracking</p></li>
<li><p>Outputs an <code class="docutils literal notranslate"><span class="pre">std.AgentTool</span></code> data item with command and args populated</p></li>
</ol>
<p>The task does NOT start the MCP server itself - it only configures how to start it.
The actual server process is started by the Agent task or agent command when needed.</p>
</section>
<section id="error-handling">
<h3>Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading">¶</a></h3>
<dl class="simple">
<dt><strong>Command not found</strong></dt><dd><p>Returns status=1 with error marker indicating the command could not be found</p>
</dd>
<dt><strong>Installation fails</strong></dt><dd><p>Returns status=1 with error marker and stderr output from installation command</p>
</dd>
<dt><strong>Validation fails</strong></dt><dd><p>Returns status=1 with error marker explaining the validation error</p>
</dd>
</dl>
</section>
</section>
<section id="agenttoolhttp-task">
<h2>AgentToolHttp Task<a class="headerlink" href="#agenttoolhttp-task" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">AgentToolHttp</span></code> task configures MCP servers that communicate via HTTP/SSE
transport. These are typically remote services or locally-hosted HTTP servers.</p>
<section id="id1">
<h3>Parameters<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<dl class="simple">
<dt><strong>url</strong> (string, required)</dt><dd><p>The base URL of the MCP server</p>
</dd>
<dt><strong>validate</strong> (bool, optional, default=false)</dt><dd><p>Whether to validate that the URL is accessible</p>
</dd>
<dt><strong>health_check_path</strong> (string, optional)</dt><dd><p>Path to append to URL for health check</p>
</dd>
<dt><strong>headers</strong> (map, optional)</dt><dd><p>HTTP headers to include in requests (e.g., API keys)</p>
</dd>
<dt><strong>timeout</strong> (int, optional, default=5)</dt><dd><p>Timeout in seconds for validation requests</p>
</dd>
</dl>
</section>
<section id="id2">
<h3>Basic Example<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LocalMCPServer</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.AgentToolHttp</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8080</span>
<span class="w">      </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MyAgent</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.Agent</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">LocalMCPServer</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">user_prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Query</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">local</span><span class="nv"> </span><span class="s">MCP</span><span class="nv"> </span><span class="s">server&quot;</span>
</pre></div>
</div>
</section>
<section id="with-validation">
<h3>With Validation<a class="headerlink" href="#with-validation" title="Link to this heading">¶</a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RemoteSearchTool</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.AgentToolHttp</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://api.example.com/mcp</span>
<span class="w">      </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</pre></div>
</div>
</section>
<section id="with-health-check-and-headers">
<h3>With Health Check and Headers<a class="headerlink" href="#with-health-check-and-headers" title="Link to this heading">¶</a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RemoteAPI</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.AgentToolHttp</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://api.example.com/mcp</span>
<span class="w">      </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">health_check_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/health</span>
<span class="w">      </span><span class="nt">headers</span><span class="p">:</span>
<span class="w">        </span><span class="nt">Authorization</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bearer</span><span class="nv"> </span><span class="s">${API_KEY}&quot;</span>
<span class="w">        </span><span class="nt">X-API-Version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;v1&quot;</span>
<span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
</pre></div>
</div>
</section>
<section id="id3">
<h3>Implementation Details<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">AgentToolHttp</span></code> task:</p>
<ol class="arabic simple">
<li><p>Validates the URL format</p></li>
<li><p>Optionally performs accessibility check if <code class="docutils literal notranslate"><span class="pre">validate=true</span></code></p></li>
<li><p>Optionally performs health check if <code class="docutils literal notranslate"><span class="pre">health_check_path</span></code> is specified</p></li>
<li><p>Creates a memento with hash of URL for up-to-date tracking</p></li>
<li><p>Outputs an <code class="docutils literal notranslate"><span class="pre">std.AgentTool</span></code> data item with url populated</p></li>
</ol>
<p>Like <code class="docutils literal notranslate"><span class="pre">AgentToolStdio</span></code>, this task only configures the connection - it does not
establish or maintain the connection. The Agent task handles the actual HTTP/SSE
communication.</p>
</section>
<section id="id4">
<h3>Error Handling<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h3>
<dl class="simple">
<dt><strong>Invalid URL format</strong></dt><dd><p>Returns status=1 with error marker if URL is malformed or missing scheme/host</p>
</dd>
<dt><strong>Connection failed</strong></dt><dd><p>Returns status=1 with error marker if validation is enabled and URL is unreachable</p>
</dd>
<dt><strong>Health check failed</strong></dt><dd><p>Returns status=1 with error marker and HTTP status code if health check fails</p>
</dd>
<dt><strong>Timeout</strong></dt><dd><p>Returns status=1 with error marker if request times out</p>
</dd>
</dl>
</section>
</section>
<section id="integration-with-agent-tasks">
<h2>Integration with Agent Tasks<a class="headerlink" href="#integration-with-agent-tasks" title="Link to this heading">¶</a></h2>
<p>The Agent task (and agent command) automatically discovers AgentTool data items
from upstream tasks through the context builder. The workflow is:</p>
<ol class="arabic simple">
<li><p>User defines AgentToolStdio or AgentToolHttp tasks</p></li>
<li><p>Agent task declares dependency on these tasks (via <code class="docutils literal notranslate"><span class="pre">needs</span></code>)</p></li>
<li><p>Context builder extracts tool configuration from task results</p></li>
<li><p>Agent runtime configures MCP client with extracted tools</p></li>
<li><p>AI assistant can use MCP tools during execution</p></li>
</ol>
<section id="context-builder-integration">
<h3>Context Builder Integration<a class="headerlink" href="#context-builder-integration" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">context_builder.py</span></code> module extracts AgentTool data from executed tasks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_extract_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">task_node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract tool/MCP server information from task.&quot;&quot;&quot;</span>
    <span class="n">tool</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="s1">&#39;desc&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;command&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="c1"># For stdio</span>
        <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="p">[],</span>     <span class="c1"># For stdio</span>
        <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>       <span class="c1"># For HTTP</span>
    <span class="p">}</span>
    <span class="c1"># Extract from task output...</span>
    <span class="k">return</span> <span class="n">tool</span>
</pre></div>
</div>
<p>The extracted tools are included in the AgentContext and passed to the AI
assistant’s MCP client configuration.</p>
</section>
</section>
<section id="complete-example-workflow">
<h2>Complete Example Workflow<a class="headerlink" href="#complete-example-workflow" title="Link to this heading">¶</a></h2>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">package</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_project</span>

<span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Configure filesystem access tool</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FileSystemAccess</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.AgentToolStdio</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npx</span>
<span class="w">      </span><span class="nt">args</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-y</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;@modelcontextprotocol/server-filesystem&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/workspace</span>

<span class="w">  </span><span class="c1"># Configure remote API tool</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ExternalAPI</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.AgentToolHttp</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://api.example.com/mcp</span>
<span class="w">      </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">headers</span><span class="p">:</span>
<span class="w">        </span><span class="nt">Authorization</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bearer</span><span class="nv"> </span><span class="s">${API_KEY}&quot;</span>

<span class="w">  </span><span class="c1"># Agent that uses both tools</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CodeAnalyzer</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.Agent</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">FileSystemAccess</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ExternalAPI</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">user_prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">Analyze all Python files in the workspace and check</span>
<span class="w">        </span><span class="no">them against the external API for best practices.</span>
<span class="w">      </span><span class="nt">result_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">analysis.json</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">CodeAnalyzer</span></code> runs:</p>
<ol class="arabic simple">
<li><p>Both tool tasks execute first (due to <code class="docutils literal notranslate"><span class="pre">needs</span></code> dependency)</p></li>
<li><p>Context builder extracts tool configurations</p></li>
<li><p>Agent runtime starts filesystem MCP server as subprocess</p></li>
<li><p>Agent runtime configures HTTP client for external API</p></li>
<li><p>AI assistant can use both tools to complete the analysis</p></li>
</ol>
</section>
<section id="testing-mcp-tool-tasks">
<h2>Testing MCP Tool Tasks<a class="headerlink" href="#testing-mcp-tool-tasks" title="Link to this heading">¶</a></h2>
<section id="unit-testing">
<h3>Unit Testing<a class="headerlink" href="#unit-testing" title="Link to this heading">¶</a></h3>
<p>Unit tests mock external dependencies:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test AgentToolStdio</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">test_agent_tool_stdio_basic</span><span class="p">(</span><span class="n">mock_subprocess</span><span class="p">):</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">create_mock_input</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;server.js&quot;</span><span class="p">])</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AgentToolStdio</span><span class="p">(</span><span class="n">mock_runner</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;std.AgentTool&quot;</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;node&quot;</span>

<span class="c1"># Test AgentToolHttp</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">test_agent_tool_http_validation</span><span class="p">(</span><span class="n">mock_requests</span><span class="p">):</span>
    <span class="n">mock_requests</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">create_mock_input</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://localhost:8080&quot;</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AgentToolHttp</span><span class="p">(</span><span class="n">mock_runner</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">url</span> <span class="o">==</span> <span class="s2">&quot;http://localhost:8080&quot;</span>
</pre></div>
</div>
</section>
<section id="integration-testing">
<h3>Integration Testing<a class="headerlink" href="#integration-testing" title="Link to this heading">¶</a></h3>
<p>Integration tests use real MCP servers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">test_agent_with_filesystem_tool</span><span class="p">():</span>
    <span class="c1"># Create flow with AgentToolStdio and Agent tasks</span>
    <span class="c1"># Execute flow</span>
    <span class="c1"># Verify agent can access filesystem via MCP</span>
    <span class="c1"># Check that files were read/written as expected</span>
</pre></div>
</div>
</section>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading">¶</a></h2>
<section id="agenttoolstdio-issues">
<h3>AgentToolStdio Issues<a class="headerlink" href="#agenttoolstdio-issues" title="Link to this heading">¶</a></h3>
<p><strong>Problem: Command not found</strong></p>
<dl class="simple">
<dt>Solutions:</dt><dd><ul class="simple">
<li><p>Ensure command is in PATH or use absolute path</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">install_command</span></code> to install dependencies first</p></li>
</ul>
</dd>
</dl>
<p><strong>Problem: Permission denied</strong></p>
<dl class="simple">
<dt>Solutions:</dt><dd><ul class="simple">
<li><p>Check file permissions on command</p></li>
<li><p>Ensure rundir has write permissions</p></li>
</ul>
</dd>
</dl>
<p><strong>Problem: Server fails to start</strong></p>
<dl class="simple">
<dt>Solutions:</dt><dd><ul class="simple">
<li><p>Check command arguments are correct</p></li>
<li><p>Review server logs in task rundir</p></li>
</ul>
</dd>
</dl>
</section>
<section id="agenttoolhttp-issues">
<h3>AgentToolHttp Issues<a class="headerlink" href="#agenttoolhttp-issues" title="Link to this heading">¶</a></h3>
<p><strong>Problem: URL unreachable</strong></p>
<dl class="simple">
<dt>Solutions:</dt><dd><ul class="simple">
<li><p>Check network connectivity</p></li>
<li><p>Verify URL format and port</p></li>
<li><p>Ensure server is running if local</p></li>
</ul>
</dd>
</dl>
<p><strong>Problem: Authentication failures</strong></p>
<dl class="simple">
<dt>Solutions:</dt><dd><ul class="simple">
<li><p>Check headers are correctly specified</p></li>
<li><p>Verify API keys are valid and not expired</p></li>
</ul>
</dd>
</dl>
<p><strong>Problem: Timeout errors</strong></p>
<dl class="simple">
<dt>Solutions:</dt><dd><ul class="simple">
<li><p>Increase timeout parameter</p></li>
<li><p>Check server response time</p></li>
</ul>
</dd>
</dl>
</section>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading">¶</a></h2>
<section id="organization">
<h3>Organization<a class="headerlink" href="#organization" title="Link to this heading">¶</a></h3>
<dl class="simple">
<dt><strong>Keep tools focused</strong></dt><dd><p>Each tool should have a single, clear purpose</p>
</dd>
<dt><strong>Use descriptive names</strong></dt><dd><p>Name tools based on their function, not their implementation</p>
</dd>
<dt><strong>Document limitations</strong></dt><dd><p>Clearly document any restrictions or requirements</p>
</dd>
</dl>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">¶</a></h3>
<dl class="simple">
<dt><strong>Use environment variables</strong></dt><dd><p>Pass sensitive data through environment variables, not command arguments</p>
</dd>
<dt><strong>Set appropriate timeouts</strong></dt><dd><p>Balance between reliability and responsiveness</p>
</dd>
<dt><strong>Enable validation in development</strong></dt><dd><p>Use <code class="docutils literal notranslate"><span class="pre">validate:</span> <span class="pre">true</span></code> during development, consider disabling in production</p>
</dd>
<dt><strong>Install once</strong></dt><dd><p>Use <code class="docutils literal notranslate"><span class="pre">install_command</span></code> with mementos to avoid redundant installations</p>
</dd>
</dl>
</section>
<section id="security">
<h3>Security<a class="headerlink" href="#security" title="Link to this heading">¶</a></h3>
<dl class="simple">
<dt><strong>Restrict filesystem access</strong></dt><dd><p>Limit filesystem tools to specific directories</p>
</dd>
<dt><strong>Validate API endpoints</strong></dt><dd><p>Use <code class="docutils literal notranslate"><span class="pre">validate:</span> <span class="pre">true</span></code> and <code class="docutils literal notranslate"><span class="pre">health_check_path</span></code> for remote services</p>
</dd>
<dt><strong>Protect credentials</strong></dt><dd><p>Never hardcode API keys; use environment variables or parameter substitution</p>
</dd>
<dt><strong>Review tool permissions</strong></dt><dd><p>Understand what each MCP server can access</p>
</dd>
</dl>
</section>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="agent_integration.html"><span class="doc">AI Agent Integration</span></a> - AI Agent Integration guide</p></li>
<li><p><a class="reference internal" href="llm_integration.html"><span class="doc">LLM Integration</span></a> - LLM Integration overview</p></li>
<li><p><a class="reference internal" href="../llms.html"><span class="doc">LLM Agent Integration</span></a> - LLM Agent Integration reference</p></li>
<li><p><a class="reference internal" href="tasks_developing.html"><span class="doc">Developing Tasks</span></a> - Developing custom tasks</p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">DV Flow Manager</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="fundamentals.html">Key Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="packages.html">Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks_using.html">Using Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataflow.html">Dataflow &amp; Produces</a></li>
<li class="toctree-l2"><a class="reference internal" href="visibility.html">Task Visibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks_developing.html">Developing Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="incremental.html">Incremental Builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Parameters and Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="expressions.html">Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced_features.html">Advanced Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="stdlib.html">Standard Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="llm_integration.html">LLM Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="agent_integration.html">AI Agent Integration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">MCP Tool Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#dataflow">Dataflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Flow-Spec Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/types_api.html">Type System API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cmdref.html">Command reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../llms.html">LLM Agent Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pytask_api.html">Python Task API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../task_runners.html">Task Runners</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">User Guide</a><ul>
      <li>Previous: <a href="agent_integration.html" title="previous chapter">AI Agent Integration</a></li>
      <li>Next: <a href="../reference/index.html" title="next chapter">Flow-Spec Reference</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2023-2025, Matthew Ballance.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/userguide/mcp_tools.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>